# Telegram Bot Analytics - Full Project Guide

ะะพะปะฝะพััะฝะบัะธะพะฝะฐะปัะฝัะน Telegram ะฑะพั ะดะปั ัะฑะพัะฐ ััะฐัะธััะธะบะธ ัะพะพะฑัะตะฝะธะน, ะฐะฝะฐะปะธะทะฐ ะฟะพะปัะทะพะฒะฐัะตะปะตะน ั ะฟะพะผะพััั Gemini AI ะธ ะฒะตะฑ-ะธะฝัะตััะตะนัะฐ ะดะปั ะฐะฝะฐะปะธะทะฐ.

## ะกัะตะบ
- **Node.js** + **TypeScript**
- **Telegraf**
- **Next.js**
- **PostgreSQL**
- **Redis**
- **Docker**

### ะฃััะฐะฝะพะฒะบะฐ

1. **ะะปะพะฝะธััะนัะต ัะตะฟะพะทะธัะพัะธะน**

   ```bash
   git clone <repo>
   cd bot_telegram
   ```

2. **ะกะบะพะฟะธััะนัะต .env ัะฐะนะป**

   ```bash
   cp .env.example .env
   ```

3. **ะะฑะฝะพะฒะธัะต ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั ะฒ `.env`**

   ```env
   TELEGRAM_TOKEN=ะฒะฐั_ัะพะบะตะฝ_ะทะดะตัั
   GEMINI_API_KEY=ะฒะฐั_gemini_ะบะปัั_ะทะดะตัั
   DB_PASSWORD=ะฒะฐัะฟะฐัะพะปั
   ```

4. **ะะฐะฟัััะธัะต ะฟัะพะตะบั ัะตัะตะท Docker**

   ```bash
   docker-compose up --build
   ```

   ะัะพะตะบั ะฑัะดะตั ะดะพัััะฟะตะฝ:

   - ๐ค ะะพั: ะฟะพะดะบะปััะตะฝ ะบ Telegram
   - ๐ ะะตะฑ-ะธะฝัะตััะตะนั: http://localhost:3000
   - ๐ API: http://localhost:3001
   - ๐๏ธ PostgreSQL: localhost:5432
   - ๐ด Redis: localhost:6379

### ะะพะบะฐะปัะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ (ะฑะตะท Docker)

```bash
# ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน
cd bot && npm install
cd ../web && npm install

# ะะฐะฟััะบ ะฑะพัะฐ
npm run dev

# ะะฐะฟััะบ API (ะฒ ะพัะดะตะปัะฝะพะผ ัะตัะผะธะฝะฐะปะต)
npm run dev:api

# ะะฐะฟััะบ ะฒะตะฑ-ะธะฝัะตััะตะนัะฐ (ะฒ ะพัะดะตะปัะฝะพะผ ัะตัะผะธะฝะฐะปะต)
cd web && npm run dev
```

---

## ๐ฏ ะคัะฝะบัะธะพะฝะฐะป

### 1. **ะกะฑะพั ะดะฐะฝะฝัั**

- ะะฒัะพะผะฐัะธัะตัะบะพะต ัะพััะฐะฝะตะฝะธะต ะฒัะตั ัะตะบััะพะฒัั ัะพะพะฑัะตะฝะธะน ะฒ ะณััะฟะฟะต
- ะััะปะตะถะธะฒะฐะฝะธะต ะธะฝัะพัะผะฐัะธะธ ะพ ะฟะพะปัะทะพะฒะฐัะตะปัั (username, ะธะผั, ัะฐะผะธะปะธั)

### 2. **ะกัะฐัะธััะธะบะฐ ัะฐัะฐ** (`/stats`)

- ะขะพะฟ-10 ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะฟะพ ะบะพะปะธัะตััะฒั ัะพะพะฑัะตะฝะธะน
- ะคะธะปัััะฐัะธั ะฟะพ ะฒัะตะผะตะฝะธ: ัะตะณะพะดะฝั, ะฝะตะดะตะปั, ะผะตััั, ะฒัั ะฒัะตะผั
- ะััะธัะพะฒะฐะฝะธะต ัะตะทัะปััะฐัะพะฒ ะฒ Redis (20 ะผะธะฝัั ะฟะพ ัะผะพะปัะฐะฝะธั)

ะะพะผะฐะฝะดะฐ:

```
/stats
```

ะะฐะฒะธะณะฐัะธั ัะตัะตะท inline ะบะฝะพะฟะบะธ:

- ๐ Today
- ๐ Week
- ๐ Month
- ๐ All Time

### 3. **ะะฝะฐะปะธะท ะฟะพะปัะทะพะฒะฐัะตะปั** (`/analyze`)

ะัะฟะพะปัะทัะตั Gemini API ะดะปั ะฐะฝะฐะปะธะทะฐ ััะธะปั ะพะฑัะตะฝะธั ะฟะพะปัะทะพะฒะฐัะตะปั.

ะะพะผะฐะฝะดั:

```
/analyze @username          # ะะฝะฐะปะธะท ะฟะพ username
(reply to message) /analyze # ะะฝะฐะปะธะท ะฐะฒัะพัะฐ ัะพะพะฑัะตะฝะธั
```

ะะตะทัะปััะฐั ะฐะฝะฐะปะธะทะฐ ะฒะบะปััะฐะตั:

- ๐ฌ ะกัะธะปั ะพะฑัะตะฝะธั (ัะพัะผะฐะปัะฝัะน/ะฝะตัะพัะผะฐะปัะฝัะน)
- ๐ ะัะฝะพะฒะฝัะต ัะตะผั
- โฐ ะะฐััะตัะฝั ะฐะบัะธะฒะฝะพััะธ
- ๐ ะขะพะฝะฐะปัะฝะพััั (ะฟะพะทะธัะธะฒะฝะฐั/ะฝะตะนััะฐะปัะฝะฐั/ะฝะตะณะฐัะธะฒะฝะฐั)
- โจ ะัะพะฑะตะฝะฝะพััะธ (ะธัะฟะพะปัะทะพะฒะฐะฝะธะต ัะผะพะดะทะธ, ัะฐัััะต ะฒะพะฟัะพัั)

### 4. **ะะตะฑ-ะธะฝัะตััะตะนั**

ะัะพััะฐั ัััะฐะฝะธัะฐ ะดะปั ะฐะฝะฐะปะธะทะฐ ะฟะพะปัะทะพะฒะฐัะตะปั ัะตัะตะท ะฑัะฐัะทะตั.

- URL: http://localhost:3000
- ะะฒะตะดะธัะต username โ ะฟะพะปััะธัะต ะฐะฝะฐะปะธะท
- ะะฝัะตะณัะฐัะธั ั API ะดะปั ะฟะพะปััะตะฝะธั ะดะฐะฝะฝัั

---

## ๐ ะััะธัะตะบัััะฐ ะัะพะตะบัะฐ

```
bot_telegram/
โโโ bot/                    # Node.js ะฑัะบะตะฝะด
โ   โโโ src/
โ   โ   โโโ index.ts       # Entry point ะฑะพัะฐ
โ   โ   โโโ api.ts         # REST API ัะตัะฒะตั
โ   โ   โโโ database/      # ะะฐะฑะพัะฐ ั PostgreSQL
โ   โ   โโโ models/        # ะะปะฐััั ะดะปั ัะฐะฑะพัั ั ะดะฐะฝะฝัะผะธ
โ   โ   โ   โโโ UserModel.ts
โ   โ   โ   โโโ ChatModel.ts
โ   โ   โ   โโโ MessageModel.ts
โ   โ   โโโ services/      # ะะธะทะฝะตั-ะปะพะณะธะบะฐ
โ   โ   โ   โโโ StatsService.ts
โ   โ   โ   โโโ GeminiService.ts
โ   โ   โ   โโโ RedisService.ts
โ   โ   โโโ handlers/      # ะะฑัะฐะฑะพััะธะบะธ ะบะพะผะฐะฝะด ะฑะพัะฐ
โ   โ   โ   โโโ messageHandler.ts
โ   โ   โ   โโโ statsHandler.ts
โ   โ   โ   โโโ analyzeHandler.ts
โ   โ   โโโ types/         # TypeScript ะธะฝัะตััะตะนัั
โ   โ   โโโ utils/         # ะฃัะธะปะธัั
โ   โโโ src/__tests__/     # Unit ัะตััั (Vitest)
โ   โโโ package.json
โ   โโโ tsconfig.json
โ   โโโ Dockerfile
โ
โโโ web/                    # Next.js ััะพะฝัะตะฝะด
โ   โโโ app/
โ   โ   โโโ page.tsx       # ะะปะฐะฒะฝะฐั ัััะฐะฝะธัะฐ
โ   โ   โโโ layout.tsx     # Layout
โ   โ   โโโ globals.css    # ะกัะธะปะธ
โ   โ   โโโ components/    # React ะบะพะผะฟะพะฝะตะฝัั
โ   โ   โโโ types/         # TypeScript ะธะฝัะตััะตะนัั
โ   โโโ package.json
โ   โโโ tsconfig.json
โ   โโโ next.config.js
โ   โโโ Dockerfile
โ
โโโ docker-compose.yml      # ะัะบะตัััะฐัะธั ัะตัะฒะธัะพะฒ
โโโ .env                    # ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั
โโโ .env.example
โโโ README.md
```

### ะะพะดะตะปะธ ะะฐะฝะฝัั

#### Users

```sql
id (PRIMARY KEY)
telegram_id (UNIQUE)
username
first_name
last_name
created_at
```

#### Chats

```sql
id (PRIMARY KEY)
telegram_id (UNIQUE)
title
created_at
```

#### Messages

```sql
id (PRIMARY KEY)
chat_id (FOREIGN KEY โ chats)
user_id (FOREIGN KEY โ users)
text
created_at
```
